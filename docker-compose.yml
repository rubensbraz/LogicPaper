services:
  # ==========================================
  # LogicPaper Core Service
  # Hosts FastAPI Backend & LibreOffice Engine
  # ==========================================
  logicpaper-app:
    build:
      context: .
      dockerfile: Dockerfile
    image: logicpaper:v1
    container_name: logicpaper

    # .env File
    env_file:
      - .env

    # Network Configuration
    # Maps localhost:8000 to container:8000
    ports:
      - "8000:8000"

    # Volume Mapping (Persistence & Hot-Reloading)
    volumes:
      # 1. Data Persistence:
      # Maps local './data' to container '/data'
      # Allows viewing generated ZIPs/PDFs from the host machine
      - ./data:/data

      # 2. Code Hot-Reloading (Development):
      # Maps local source code to container paths
      # Changes in Python or HTML reflect immediately without rebuilding
      - ./app:/app/app
      - ./static:/app/static

      # 3. Templates Storage:
      - ./persistent_templates:/app/persistent_templates

    # Execution Command
    # Uses Uvicorn with --reload for development agility
    # In a pure production environment, remove '--reload'
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

    # Restart Policy
    # Automatically restarts the container if it crashes (unless stopped manually)
    restart: unless-stopped

    # Resource Limits (Stability Guardrails)
    # LibreOffice conversion is CPU/RAM intensive
    # These limits prevent the container from crashing the host system
    deploy:
      resources:
        limits:
          cpus: '2.0'       # Cap at 2 CPU cores
          memory: 2G        # Cap at 2GB RAM
        reservations:
          memory: 512M      # Reserve minimal 512MB RAM